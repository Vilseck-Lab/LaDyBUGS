# Generate CHARMM psf and pdb files
This step requires the use of CHARMM. CHARMM can be obtained following the instructions listed here:
https://academiccharmm.org/program

When using CHARMM force fields in OpenMM, a CHARMM generated psf and pdb are needed to load into OpenMM (in `../2.gen_omm_system`). Those files can be generated with these scripts.

After CHARMM is installed, copy your system specific `prep/` directory (that contains ligand hybrid topology files, protein pdbs, solvent pdbs, ion pdbs, and all toppar files) into this directory. For ligand perturbations, these files can be generated with the assistance of msld_py_prep.

In the prep directory, write a `msld_sele.str` file that defines substituent selections for each alchemical functional group. Often this portion of code can by directly copied from the charmm msld input script generated by msld_py_prep.py

Edit nsubs to list of the number of substituents to be sampled in a LaDyBUGS calculation. For example, for the MUP system in `example`, nsubs is '6', representing that 6 substituents are sampled at one site off the ligand core. LaDyBUGS is currently coded to only examine single-site perturbations. This file is also generated by msld_py_prep.

Double check that all information in genpsf.inp matches the needs of your system. Then submit the genpsf.job script to slurm (or your local queue scheduler) to generate your CHARMM `patch.psf` and `patch.pdb` files.

Finally, run `get_alchem_idx.py` to identify the atom numbers of your alchemical atoms in the CHARMM psf for use in step 2 of the step. It's helpful to write this to a file for further reference (see `example/idx.txt` for an example).

