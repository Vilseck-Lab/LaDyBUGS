* CHARMM input file for Wang-Landau Lambda Dynamics
* generated by create_genpsf.py MTR (04/2021)

set fnex = 5.5
set builddir = prep
set box = 80.0
set temp = 298.15
set ligseg = lig
set resnum = 1

! perturbation variables
set nsites = 1
set nsubs1 = 2
bomblev -2

!! Read in toppar stream file
stream @builddir/toppar.str

read rtf append card name @builddir/core.rtf
read param flex append card name @builddir/full_ligand.prm

!! Reads coordinates and pdb file for the protein
read sequ pdb name pro1.pdb
generate PRO1 first PROP last CT3 setup warn
read coor pdb resid name pro1.pdb

read sequ pdb name pro2.pdb
generate PRO2 first ACE last CTER setup warn
read coor pdb resid name pro2.pdb

ic generate
ic param
ic build
hbuild sele hydrogen end
auto angle dihe

!! Reads coordinates and pdb file for the ligand
read sequ pdb name @builddir/core.pdb
generate @ligseg setup
read coor pdb resid name @builddir/core.pdb

!! stream the ligand patches, affect the connectivity
stream @builddir/lig_specific.str
!! don't call auto angle dihe after this

define ligpp sele (segid LIG) show end
define backbone sele (segid PRO% .and. -                                       ! protein segids
                     (type N .or. type CA .or. type C .or. type O .or. -       ! normal backbone atoms
                      type CY .or. type OY .or. type CAY .or. -                ! ACE backbone atoms
                      type NT .or. type CAT)) show end                         ! CT3 backbone atoms

define rad16 sele .byres. (ligpp .around. 16) show end
define rigidbb sele (backbone .and. .not. rad16) show end

define protein sele (segid PRO% .or segid P01%) end



!! Load solvent

read sequ pdb name @builddir/fitted-solv_10.0.pdb
generate SOLV first none last none setup noangl nodihe
read coor pdb resid name @builddir/fitted-solv_10.0.pdb


!! Load ions
read sequ pdb name ions.pdb
generate IONS  first none last none setup noangl nodihe
read coor pdb resid name ions.pdb

print coor sele .not. init end

bomblev 0

!!!! For OpenMM, you are supposed to translate the box to the origin !!!!
calc box2 = @box / 2
coor stat
coor translate xdir @box2 ydir @box2 zdir @box2 select all end

!! Write Initial System to Disk
write psf card name patch.psf
* patch psf file
*
write coor pdb card name patch.pdb
* patch pdb file
*
write coor card name patch.crd
* patch crd file
*

stop
